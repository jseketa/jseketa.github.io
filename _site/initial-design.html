<html>
	<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" rel="stylesheet">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>

	<!-- Site specific -->
	<link href="http://localhost:4000/assets/css/main.css" rel="stylesheet">
	
	<script type="text/javascript" src="http://localhost:4000/assets/js/script.js"></script>
	<script type="text/javascript" src="http://localhost:4000/assets/js/qrious.min.js"></script>
	<link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
	<title>Initial design</title>
	
</head>
	<body>
	<div class="wrapper">
	<!-- Sidebar  -->

	<nav id="sidebar">
	    <button type="button" id="sidebarCollapse" class="btn btn-info">
            <i class="fas fa-eye"></i>
        </button>
		
		<div class="sidebar-header">
			<div class="profile-photo"><a href="http://localhost:4000" class="home"><img src="/assets/author.png"></img></a></div>
		</div>

		<ul class="list-unstyled components">
			<div class="social-links">
	<a href="https://facebook.com/jseketa" target="_blank"><i class="btn btn-light fab fa-facebook-f fa-3x"></i></a> 
	<a href="https://twitter.com/jseketa" target="_blank"><i class="btn btn-light fab fa-twitter fa-3x"></i></a> 
		<a href="https://github.com/jseketa" target="_blank"><i class="btn btn-light fab fa-github-alt fa-3x"></i></a> 
	<a href="https://linkedin.com/in/jseketa" target="_blank"><i class="btn btn-light fab fa-linkedin-in fa-3x"></i></a> 
</div>
			<li>
				<a href="#">About</a>
			</li>
			<li>
				<a href="#">Portfolio</a>
			</li>
			<li>
				<a href="#">Contact</a>
			</li>
		</ul>
    		<p class="qr-current">Read me on your phone:</p>
			<center><canvas id="qr"></canvas></center>
	</nav>
	
		
	<script>
	(function() {
		var qr = new QRious({
		element: document.getElementById('qr'),
		value: 'http://localhost:4000/initial-design',
		backgroundAlpha: 0,
		padding: 0,
		size: 200,
		});
	})();
	</script>
	<div id="content">
		<div class="row justify-content-md-center pt-3">
			<div class="col col-md-12 col-lg-10">
			<h1 id="initial-design">Initial design</h1>

<p><img src="/assets//images/boring_writer.gif" alt="alt text" title="Boring writer" />
<img src="/assets/images/concept_level.gif" alt="alt text" title="Concept level" /></p>

<p>I would like the take the very first paragraph to get the logical basics down. Programming implementation down the road is “just” a question of a language syntax.</p>

<p>Before I wrote anything there was reconnaisance to be made.
With the help of the Chrome Developer tools I recorded the steps needed to login to the overview page (automatic redirect).</p>

<p>Login consists of the two levels:</p>
<ol>
  <li>Login with the e-mail which takes us to the overview of servers and already active accounts</li>
  <li>Login to the specific account</li>
</ol>

<p>Firstly I needed to set the minimum goal. The goal was to successfully login to the game and just output the pure html; if successful I would get the wall of text in the console, otherwise just a short piece of redirect code (HTTP 301<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>).</p>

<p>Using apitester.com for quick and dirty test.</p>

<p><img src="/assets/images/first_post.png" alt="alt text" title="Title" /></p>

<p>If successful, the post request should return the token, among other things.</p>

<p><strong>Request url</strong>:</p>

<p>https://gameforge.com/api/v1/auth/thin/sessions</p>

<p><strong>Request method</strong>:</p>

<p>POST</p>

<p><strong>Request body</strong>:</p>

<p>identity=en.GB.scraper@gmail.com&amp;password=Scraper12345&amp;locale=de_DE&amp;gfLang=de&amp;platformGameId=1dfd8e7e-6e1a-4eb1-8c64-03c3b62efd2f&amp;gameEnvironmentId=0a31d605-ffaf-43e7-aa02-d06df7116fc8&amp;autoGameAccountCreation=false</p>

<p><strong>Request valid response body</strong>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"token"</span><span class="p">:</span><span class="s2">"e9f942cc-b714-462b-91bb-ef91b40f08d1"</span><span class="p">,</span><span class="w">
</span><span class="nl">"isPlatformLogin"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
</span><span class="nl">"isGameAccountMigrated"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
</span><span class="nl">"platformUserId"</span><span class="p">:</span><span class="s2">"95ddac3a-d1b6-4160-9a5b-2a623f8d94de"</span><span class="p">,</span><span class="w">
</span><span class="nl">"isGameAccountCreated"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
</span><span class="nl">"hasUnmigratedGameAccounts"</span><span class="p">:</span><span class="kc">false</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>Request invalid response body</strong>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"error"</span><span class="p">:{</span><span class="nl">"message"</span><span class="p">:</span><span class="s2">"Forbidden"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<p><img src="/assets/images/first_post_token.png" alt="alt text" title="Title" /></p>

<p>Process diagram:
POST form data –&gt; receive valid response
				–&gt; receive invalid response</p>

<p>Let’s see how the first step looks like.
Used library: request-promise <sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>
Success criteria: fetch all the accounts bound to the user/player</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">rp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">request-promise</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">user_agent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">tough</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">tough-cookie</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">jar</span> <span class="o">=</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">jar</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">links</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">post</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://gameforge.com/api/v1/auth/thin/sessions</span><span class="dl">'</span><span class="p">,</span>
	<span class="na">accounts</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://lobby.ogame.gameforge.com/api/users/me/accounts</span><span class="dl">'</span>
<span class="p">};</span>

<span class="nx">login_post_options</span> <span class="o">=</span> <span class="p">{</span>
			<span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">uri</span><span class="p">:</span> <span class="nx">links</span><span class="p">.</span><span class="nx">post</span><span class="p">,</span>
			<span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">User-Agent</span><span class="dl">'</span><span class="p">:</span> <span class="nx">user_agent</span><span class="p">},</span>
			<span class="na">form</span><span class="p">:</span> <span class="p">{</span>				
				<span class="dl">'</span><span class="s1">identity</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">en.gb.scraper@gmail.com</span><span class="dl">'</span><span class="p">,</span>
				<span class="dl">'</span><span class="s1">password</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Scraper12345</span><span class="dl">'</span><span class="p">,</span>
				<span class="dl">'</span><span class="s1">locale</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">de_DE</span><span class="dl">'</span><span class="p">,</span>
				<span class="dl">'</span><span class="s1">gfLang</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">de</span><span class="dl">'</span><span class="p">,</span>
				<span class="dl">'</span><span class="s1">platformGameId</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1dfd8e7e-6e1a-4eb1-8c64-03c3b62efd2f</span><span class="dl">'</span><span class="p">,</span>
				<span class="dl">'</span><span class="s1">gameEnvironmentId</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0a31d605-ffaf-43e7-aa02-d06df7116fc8</span><span class="dl">'</span><span class="p">,</span>
				<span class="dl">'</span><span class="s1">autoGameAccountCreation</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">false</span><span class="dl">'</span>
			<span class="p">},</span>
			<span class="na">jar</span><span class="p">:</span> <span class="nx">jar</span><span class="p">,</span>
			<span class="na">resolveWithFullResponse</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="na">json</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">};</span>

<span class="nx">get_options</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">accounts</span><span class="p">:</span> <span class="p">{</span>
		<span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">uri</span><span class="p">:</span> <span class="nx">links</span><span class="p">.</span><span class="nx">accounts</span><span class="p">,</span>
		<span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
			<span class="dl">'</span><span class="s1">User-Agent</span><span class="dl">'</span><span class="p">:</span> <span class="nx">user_agent</span><span class="p">,</span>
			<span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">:</span> <span class="kc">null</span>
			<span class="p">},</span>
		<span class="na">followAllRedirects</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
		<span class="na">jar</span><span class="p">:</span> <span class="nx">jar</span><span class="p">,</span>
		<span class="na">resolveWithFullResponse</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="na">json</span><span class="p">:</span> <span class="kc">true</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">set_authorization_token</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">get_options</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">Authorization</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Bearer </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">token</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">get_accounts</span> <span class="p">()</span> <span class="p">{</span>
<span class="k">try</span> <span class="p">{</span>
	<span class="c1">//first post request - 1st step login</span>
	<span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">rp</span><span class="p">(</span><span class="nx">login_post_options</span><span class="p">)</span>
	<span class="nx">set_authorization_token</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
	<span class="c1">//get all the accounts</span>
	<span class="kd">let</span> <span class="nx">account</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">rp</span><span class="p">(</span><span class="nx">get_options</span><span class="p">.</span><span class="nx">accounts</span><span class="p">);</span>
	<span class="k">return</span> <span class="nx">account</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="nx">get_accounts</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">result</span><span class="p">,{</span><span class="na">depth</span><span class="p">:</span> <span class="kc">null</span><span class="p">}));</span>

</code></pre></div></div>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>More on HTTP codes: https://en.wikipedia.org/wiki/List_of_HTTP_status_codes <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>https://github.com/request/request-promise, deprecated as of 1st of April 2020 <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

			</div>
		</div>
	</div>
</div>

    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

	<script type="text/javascript">
	$(document).ready(function () {
		$("#sidebar").mCustomScrollbar({
			theme: "minimal"
		});

		$('#sidebarCollapse').on('click', function () {
			$(this).find('.svg-inline--fa').toggleClass('fa-eye fa-eye-slash');
			$('#sidebar, #content, #sidebarCollapse').toggleClass('active');
			$('.collapse.in').toggleClass('in');
			$('a[aria-expanded=true]').attr('aria-expanded', 'false');
		});
	});
    </script>	
	</body>
</html>
